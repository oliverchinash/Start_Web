 @{ 
     SuperMarket.Model.VWMemberEntity mem = ViewBag.VWMember;
 }
<!doctype html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>小店-填写公司信息</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link rel="stylesheet" href="/Themes/Basic/css/amazeui.min.css">
    <link href="/themes/basic/css/basic.css" rel="stylesheet" />
    <link rel="stylesheet" href="/Themes/Basic/css/relogin.css">
    <script src="/themes/basic/js/jquery-1.11.1.min.js"></script>
     <script src="/themes/basic/js/common.js"></script>

    <link rel="stylesheet" type="text/css" href="/Themes/Basic/Js/diyUpload/css/webuploader.css">
    <link rel="stylesheet" type="text/css" href="/Themes/Basic/Js/diyUpload/css/diyUpload.css">
    <script type="text/javascript" src="/Themes/Basic/Js/diyUpload/js/webuploader.js"></script>
    <script type="text/javascript" src="/Themes/Basic/Js/diyUpload/js/diyUpload.js?type==@SuperMarket.Core.ConfigCore.Instance.ConfigCommonEntity.JsVersion.GlobalCarts"></script>
    <script src="/themes/common/js/commoncontrolbind.js?type==@SuperMarket.Core.ConfigCore.Instance.ConfigCommonEntity.JsVersion.GlobalCarts"></script>
    <script src="/themes/common/js/jsglobalenum.js?type==@SuperMarket.Core.ConfigCore.Instance.ConfigCommonEntity.JsVersion.GlobalCarts"></script>
     
</head>
<body>
    <input id="txtPicServerRootUrl" type="hidden" value="@(SuperMarket.Core.ConfigCore.Instance.ConfigCommonEntity.ImagesServerUrl)" />
    <input  type="hidden" id="txtUserId"  value="@mem.MemId"  >
    <div style="display:none;">
        <input type="hidden" id="hidLoginWebUrl" value="@SuperMarket.Core.ConfigCore.Instance.ConfigCommonEntity.LoginWebUrl" />
    </div>
    <div class="validate">
        <!----头部开始------>
        <header data-am-widget="header" class="am-header header">
            @Html.Partial("controls/_HeadBanner")
            <h1 class="am-header-title"> 
                    公司信息
            </h1>
        </header>
        <!----头部结束------>
        <!---注册开始---->
        <p id="perrormsg"  style="text-indent: 1rem; margin-bottom: 0; padding:  0; color:red; margin-top: 0; display:none; "></p> 
        <form>
            <!---------企业信息---------->
            <div class="validate-form"> 
                <div class="validate-input">
                    <span><span style="color:red">*</span>用户名:</span>
                    <input type="text"  id="txtUserName" @(string.IsNullOrEmpty(mem.MemCode)?"":"readonly")  onblur="CheckLogin()" value="@mem.MemCode" placeholder="请输入">
                    <span style="color: red;" id="spanUserNamemsg" ></span>
                </div>
                <div class="validate-input">
                    <span><span style="color:red">*</span>密码:</span>
                    <input type="password" id="txtPassWord" placeholder="例如：asd123456"  onchange="FunCheckPassWord(this)">
                    <span style="color: red;" id="spanPassWordmsg"></span>
                </div>
                <div class="validate-input">
                    <span><span style="color:red">*</span>确认密码:</span>
                    <input type="password" id="txtPassWord2" placeholder="请输入"  onchange="FunCheckPassWordRe(this)">
                    <span style="color: red;" id="spanPassWord2msg"></span>
                </div> 
            </div>
            <div class="validate-form">
                <div class="validate-input">
                    <span><span style="color:red">*</span>公司名称:</span>
                    <input type="text" id="txtCompanyName" value="@mem.CompanyName" placeholder="请输入">
                </div>
                <div class="validate-input">
                    <input type="hidden" id="hidProvince"  value="@mem.CompanyProvinceId"  />
                    <input type="hidden" id="hidCity" value="@mem.CompanyCityId" />
                    <span><span style="color:red">*</span>公司位置:</span> 
                    <select  id="selProvince"  >
                        <option value="0">请选择</option>
                    </select>
                    <select   id="selCity">
                        <option value="0">请选择</option>
                    </select>
                </div>
                <div class="validate-input">
                    <span><span style="color:red">*</span>公司详细地址:</span>
                    <input type="text"  id="txtCompanyAddress"  value="@mem.CompanyAddress"  placeholder="请输入">
                </div> 
                <div class="validate-input-radio am-cf">
                    <input id="hidCompanyType" type="hidden"  value="@mem.CompanyType" />
                    <span class="am-fl"><span style="color:red">*</span>企业类型:</span>
                    <div class="am-form-group am-fl">
                        <label class="am-radio-inline">
                            <input type="radio"  value="1" name="radCompanyType"  >4S店
                        </label>
                        <label class="am-radio-inline">
                            <input type="radio" value="2" name="radCompanyType"  >维修厂
                        </label>
                        <label class="am-radio-inline">
                            <input type="radio"  value="3" name="radCompanyType" >经销商
                        </label>
                    </div>
                </div>
            </div>
            <!-------企业信息结束--------->
            <!----------- 联系人---------->
            <div class="validate-form">
                <div class="validate-input">
                    <span><span style="color:red">*</span>联系人姓名:</span>
                    <input type="text" id="txtContactsManName"  value="@mem.ContactsManName"  placeholder="请输入">
                </div>
                <div class="validate-input">
                    <span>&nbsp;</span> 
                        <span>联系人手机:</span>
                        <input type="text" id="txtMobile" readonly="readonly" value="@ViewBag.MobileNo" placeholder="请输入">
                    <input  id="txtMobileYZCode" type="hidden"  value="@ViewBag.MobileNoYZCode" />

</div>
                <div class="validate-input"> 
                    <span style="color:red">&nbsp;</span>
                    <span>联系人邮箱:</span>
                    <input type="text" id="txtContactsEmail"  value="@mem.ContactsEmail" placeholder="请输入">
                </div>
            </div>
            <!--------推荐联系人结束-------->
        </form>
        <input id="txtLisencePath" type="hidden" value="@mem.LicensePath" />
        <div class="validate-img am-g">
            <p>请上传大小在5M以内的营业执照或门头照片，支持格式：JEPG/PNG/JPG</p>
            <div class="am-u-sm-6" >
                <div  id="divuploadlisence"><img id="imglisence" src="/Themes/Basic/img/validate_tp.png"></div> 
                <div><span style="color:red">*</span>上传</div>
            </div>
            <div class="am-u-sm-6">
                <img src="/Themes/Basic/img/validate_tp.png">
                <div>示例</div>
            </div>
        </div>
        <div style="padding: 1rem 2rem">
            <a class="am-btn register-sub" href="javascript:void(0);" onclick="Register()" type="submit">提交认证</a>
        </div>
    </div> 
</body>
</html>
<script>

    function CheckLogin() {
        var usercode = $.trim($("#txtUserName").val()); 
        var userid = $.trim($("#txtUserId").val());
        var isex = $.ajax({ url: "/Home/CheckMemberCode", async: false, data: "useraccount=" + usercode + "&userid=" + userid }).responseText;
          if (isex == 1) { 
            $("#spanUserNamemsg").html('账号名已存在'); 
            $("#txtUserName").focus();
            return false;
        }
        else {
            $("#spanUserNamemsg").html("");
        }
    }


    function FunCheckPassWord(obj) {
        if ($("#txtPassWord").val() != $("#txtPassWord2").val() && $("#txtPassWord2").val() != "") {
            $(obj).val("");
            $("#spanPassWordmsg").html("两次密码输入不一致");
            return;
        }
        else if (/^\d*$/.test($(obj).val()) || /^[a-zA-Z]$/.test($(obj).val()) || /^[^\da-zA-Z]$/.test($(obj).val())) {
            $(obj).val("");
            $("#spanPassWordmsg").html("至少使用两种字符组合(如asd123456)");
            return;
        }
        else if ($(obj).val().length < 6 || $(obj).val().length>18) {
            $(obj).val("");
            $("#spanPassWordmsg").html("密码位数要在6-18位");
            return;
        }
        else { 
            $("#spanPassWordmsg").html("");
        }
    }

    function FunCheckPassWordRe(obj) { 
        if ($("#txtPassWord").val() != $("#txtPassWord2").val()) { 
            $(obj).val("");
            $("#spanPassWord2msg").html("两次密码输入不一致").show();
            return; 
        } 
        else if (/^\d*$/.test($(obj).val()) || /^[a-zA-Z]$/.test($(obj).val()) || /^[^\da-zA-Z]$/.test($(obj).val())) { 
            $(obj).val("");
            $("#spanPassWord2msg").html("至少使用两种字符组合(如asd123456)").show();
            return; 
        } 
        else {
            $("#spanPassWord2msg").html("");
        }
    }

    function Register() {
        var usercode = $.trim($("#txtUserName").val());
        var txtPassWord = $.trim($("#txtPassWord").val());
        var txtPassWordRe = $.trim($("#txtPassWord2").val());
        var txtMobile = $.trim($("#txtMobile").val());
        var txtMobileYZCode = $.trim($("#txtMobileYZCode").val());

        var companyname = $.trim($("#txtCompanyName").val());
        var province = $.trim($("#hidProvince").val());
        var city = $.trim($("#hidCity").val());
        var address = $.trim($("#txtCompanyAddress").val());
        var comtype = $('#hidCompanyType').val();
        var recommend = $.trim($("#txtRecommendCode").val());
        var contractmanname = $.trim($("#txtContactsManName").val());
        var email = $.trim($("#txtContactsEmail").val());
        var lisencepath=  $.trim($("#txtLisencePath").val());
        var jiaoyan = true;
        if (usercode == "" ) {
            $("#perrormsg").html("用户名不能为空"); $("#perrormsg").show();
            $("#txtUserName").focus();
            jiaoyan = false;
        } 
        if (jiaoyan&&txtPassWord == "") {
            $("#perrormsg").html("密码不能为空"); $("#perrormsg").show();
            $("#txtPassWord").focus();
            jiaoyan = false;
        } 
        if (jiaoyan && txtPassWordRe == "") {
            $("#perrormsg").html("密码校验不能为空"); $("#perrormsg").show(); $("#txtPassWord2").focus();
            jiaoyan = false;
        }
        else if (txtPassWordRe != txtPassWord) {
            $("#perrormsg").html("两次输入密码不一致"); $("#perrormsg").show(); $("#txtPassWord2").focus();
            jiaoyan = false;
        } 
        if (jiaoyan && txtMobile == "") {
            $("#perrormsg").html("联系人手机号码不能为空"); $("#perrormsg").show(); $("#txtMobile").focus();
            jiaoyan = false;
        }  
        if (jiaoyan && companyname == "") {
            $("#perrormsg").html("公司名称不能为空"); $("#perrormsg").show(); $("#txtCompanyName").focus();
            jiaoyan = false;
        } 
        if (jiaoyan && (province == "" || province == "0" || city == "" || city == "0")) {
            $("#perrormsg").html("请选择省份城市"); $("#perrormsg").show();
            jiaoyan = false;
        }  
        if (jiaoyan && (comtype == "" || comtype == "0")) {
            $("#perrormsg").html("请选择企业类型"); $("#perrormsg").show();
            jiaoyan = false;
        }  
        if (jiaoyan && contractmanname == "") {
            $("#perrormsg").html("联系人姓名不能为空"); $("#perrormsg").show(); $("#txtContactsManName").focus();
            jiaoyan = false;
        }  
        if (jiaoyan && address == "") {
            $("#perrormsg").html("公司地址不能为空"); $("#perrormsg").show(); $("#txtCompanyAddress").focus();
            jiaoyan = false;
        } if (jiaoyan && lisencepath == "") {
            $("#perrormsg").html("营业执照不能为空额");
            $("#perrormsg").show();
            jiaoyan = false;
        } 
        if (!jiaoyan) {
            return;
        } 
        if (txtPassWord.length < 6 || txtPassWord.length > 18) {
            $("#perrormsg").html("密码应为6-18位的字符和数字组合"); $("#perrormsg").show();
            $("#txtPassWord").focus();
            return false;
        } 

        $.post("/Home/CompanyRegister", {
            useraccount: usercode, password: txtPassWord, mobile: txtMobile, mobilecode: txtMobileYZCode,
            companyname: companyname, province: province, city: city, comtype: comtype, contractmanname: contractmanname, address: address, email: email,
            recommend: recommend, lisencepath: lisencepath
        }, function (data) {
            var _returncode = eval("(" + data + ")");
            var status = -_returncode.Status;
             
            if (status == _TheArray[0]) { 
                location.href = "/MobileHome/Index";
            }
            else {
                $("#perrormsg").html(_TheArray[status]); $("#perrormsg").show();
                return false;
            }
        });

        return false;
    }

    

    $(function () {
        //初始化绑定值
        BindDropParent($("#selProvince"), "/Common/GetProvinceJson", "", $("#hidProvince").val()); //绑定省份下拉框
        if ($("#hidProvince").val() != "" && $("#hidProvince").val() != "0")
        {
            var param = { pcode: $("#hidProvince").val() }
            BindDropParent($("#selCity"), "/Common/GetCityJson", param,$("#hidCity").val()); //绑定市下拉框
        }
        if ($("#hidCompanyType").val() != "" && $("#hidCompanyType").val() != "0")
        { 
            $("input[type=radio][name=radCompanyType][value=" + $("#hidCompanyType").val() + "]").attr("checked", 'checked');
        }

        $("#selProvince").change(function () { //省份下拉框change事件
            $("#hidProvince").val($(this).find("option:selected").val());
            $("#hidCity").val("");
            var param = { pcode: $(this).val() }
            BindDropParent($("#selCity"), "/Common/GetCityJson", param); //绑定市下拉框
        });
        $("#selCity").change(function () { //绑定市下拉框change事件
            $("#hidCity").val($(this).find("option:selected").val());
        });
        $("input[name=radCompanyType]").click(function () {
            $("#hidCompanyType").val($(this).val());
        });
            var arrimagespath = new Array(); 
            //实例化每个div
            $('#divuploadlisence').diyUpload({
                url: '/Home/UploadLicense', 
                imagedefaultpath: arrimagespath,
                fileNumMax: 1,
                formData: {
                    pictype: 3  //营业执照或门头照片
                },
                success: function (fileid, data) { 
                    if (data != "" && data.pic_raw != "") {
                        var strimagesurl = $("#txtPicServerRootUrl").val(); 
                        $("#txtLisencePath").val(data.pic_raw); 
                        $("#imglisence").attr("src", strimagesurl + data.pic_raw);
                        $("#imglisence").attr("fileid", fileid);
                    }  
                }, 
                complete: function () {

                },
                error: function (err) {
                    alert(err);
                }
            }); 
    })
</script>